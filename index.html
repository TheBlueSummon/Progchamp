<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
    content="width=device-width, initial-scale=1.0">
    <title>Progchamp</title>

    <link rel="stylesheet" href="styles.css" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/cytoscape/2.7.10/cytoscape.js'></script>
    <script src="clicks.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="gfx/pogchamp-twitch-own3d.png">
        </div>
        <form>
            <div class="search">
                <span class="search-icon material-symbols-outlined">search</span>
                <input class="search-input" type="search" placeholder="Search">
            </div>
        </form>
    </header>
    <main>
        <div class="toggle">
            <div class="toggle-options">
                Merge
                <div class="sep-line"></div>
                <b>Sort</b>
                <div class="sep-line"></div>
                Shell
            </div>
        </div>
        <div class="bulk">
            <div class="graph" id="langviz"></div>
            <div class="sep-line"></div>
            <div class="graph" id="repoviz"></div>
            <div class="info-box right smol" id="repo">
                <span class="material-symbols-outlined arrow" id = 'arrow2'>
                    keyboard_arrow_down
                    </span>
                <h1 id="reponame"><u>Qutee.jl</u></h1>
                <p id="repodes">This is dummy text for description/README.md placeholder.</p>
                <ul id="repolang"> <h3>Langauges used:</h3>
                    <li><b>69%</b> L1</li>
                    <li><b>42%</b> L2</li>
                </ul>
            </div>
            <div class="info-box left smol" id="lang">
   
                <span class="material-symbols-outlined arrow" id = 'arrow1'>
                    keyboard_arrow_down
                    </span>
                <h1><u>Julia</u></h1>
                <p>This is dummy text for when we figure out how to import language description.</p>
            </div>
        </div>
    </main>

    <!-- Initial processing of data -->
    <script>
        // Fetch is UGLY 
        fetch('langList.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch data.json');
                }
                return response.json();
            })
            .then(langList => {

        fetch('languages.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch data.json');
                }
                return response.json();
            })
            .then(langData => {

        // Function to load JSON file and return its content
        async function loadJSON(filename) {
            const response = await fetch(encodeURIComponent(filename));
            if (!response.ok) {
                throw new Error('Failed to fetch ' + filename);
            }
            return response.json();
        }

        // Function to load and aggregate JSON data from multiple files
        async function comboJSON(names) {
            let aggregateData = [];

            for (let name of names) {
                // Construct filename
                let filename = 'src/' + name + '_repos_metadata.json';
                
                try {
                    // Load JSON data from file
                    let jsonData = await loadJSON(filename);
                    aggregateData.append(jsonData);
                } catch (error) {
                    console.error('Error loading JSON file:', error.message);
                }
            }

            return aggregateData;
        }

        comboJSON(langList)
            .then(repoData => {
                console.log(repoData[200])
            })
            .catch(error => {
                console.error('Error aggregating JSON files:', error.message);
            });

            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    </script>

    <!-- handle clicks -->
    <script>
        var arrow1 = document.getElementById('arrow1');
        var arrow2 = document.getElementById('arrow2');

        arrow1.addEventListener('click', function() {toggleIcon(arrow1);});
        arrow2.addEventListener('click', function() {toggleIcon(arrow2);});
    </script>

    <!-- visualizer -->
    <script>
        var la = cytoscape({
            container: document.getElementById('langviz'),
            elements: [
                { data: { id: 'a' } },
                { data: { id: '0' } },
                { data: { id: '1' } },
                { data: { id: '2' } },
                { data: { id: '3' } },
                { data: { id: '4' } },
                { data: { id: '5' } },
                { data: { id: '6' } },
                { data: { id: '7' } },
                { data: { id: '8' } },
                { data: { id: '9' } },
                {
                    data: {
                        id: 'a0',
                        source: 'a',
                        target: '0',
                    }
                },
                {
                    data: {
                        id: 'a1',
                        source: 'a',
                        target: '1',
                    }
                },
                {
                    data: {
                        id: 'a2',
                        source: 'a',
                        target: '2',
                    }
                },
                {
                    data: {
                        id: 'a3',
                        source: 'a',
                        target: '3',
                    }
                },
                {
                    data: {
                        id: 'a4',
                        source: 'a',
                        target: '4',
                    }
                },
                {
                    data: {
                        id: 'a5',
                        source: 'a',
                        target: '5',
                    }
                },
                {
                    data: {
                        id: 'a6',
                        source: 'a',
                        target: '6',
                    }
                },
                {
                    data: {
                        id: 'a7',
                        source: 'a',
                        target: '7',
                    }
                },
                {
                    data: {
                        id: 'a8',
                        source: 'a',
                        target: '8',
                    }
                },
                {
                    data: {
                        id: 'a9',
                        source: 'a',
                        target: '9',
                    }
                }],
            style : [
                {
                    selector: 'node',
                    style: {
                        shape: 'circle',
                        'background-color': 'blue',
                        label: 'data(id)',
                        'text-valign': 'center',
                        'color': '#FF9900',
                        'font-size': 8
                    }
                },
                {
                    selector: '#a',
                    style: {
                        'background-color': '#FF9900',
                        label: 'bruh',
                        'color': 'blue'
                    }
                }
            ],
            layout: {
                name: 'concentric'
            }
        });
        var re = cytoscape({
            container: document.getElementById('repoviz'),
            elements: [
                { data: { id: 'a' } },
                { data: { id: '0' } },
                { data: { id: '1' } },
                { data: { id: '2' } },
                { data: { id: '3' } },
                { data: { id: '4' } },
                { data: { id: '5' } },
                { data: { id: '6' } },
                { data: { id: '7' } },
                { data: { id: '8' } },
                { data: { id: '9' } },
                {
                    data: {
                        id: 'a0',
                        source: 'a',
                        target: '0',
                    }
                },
                {
                    data: {
                        id: 'a1',
                        source: 'a',
                        target: '1',
                    }
                },
                {
                    data: {
                        id: 'a2',
                        source: 'a',
                        target: '2',
                    }
                },
                {
                    data: {
                        id: 'a3',
                        source: 'a',
                        target: '3',
                    }
                },
                {
                    data: {
                        id: 'a4',
                        source: 'a',
                        target: '4',
                    }
                },
                {
                    data: {
                        id: 'a5',
                        source: 'a',
                        target: '5',
                    }
                },
                {
                    data: {
                        id: 'a6',
                        source: 'a',
                        target: '6',
                    }
                },
                {
                    data: {
                        id: 'a7',
                        source: 'a',
                        target: '7',
                    }
                },
                {
                    data: {
                        id: 'a8',
                        source: 'a',
                        target: '8',
                    }
                },
                {
                    data: {
                        id: 'a9',
                        source: 'a',
                        target: '9',
                    }
                }],
            style : [
                {
                    selector: 'node',
                    style: {
                        shape: 'circle',
                        'background-color': 'blue',
                        label: 'data(id)'
                    }
                },
                {
                    selector: '#a',
                    style: {
                        shape: 'circle',
                        'background-color': '#FF9900',
                        label: 'data(id)'
                    }
                }
            ],
            layout: {
                name: 'concentric'
            }
        });
    </script>
    <!-- Reading JSON data -->
    <script>
        function changeData(target, data) {
            target.textContent = data;
        }
        function updateRepo(data) {
            var rn = document.getElementById('reponame');
                var rd = document.getElementById('repodes');
                changeData(rn, data[0]['name'])
                changeData(rd, data[0]['description']);
                
                var list = document.getElementById('repolang')
                // Remove all existing list items from the ul element
                while (list.firstChild) {
                    list.removeChild(list.firstChild);
                }
                // Iterate through the languages and add to list
                for (var l in data[0]['languages']) {
                    var listItem = document.createElement('li');
                    listItem.textContent = l + ': ' + data[0]['languages'][l];
                    list.appendChild(listItem);
                }
        }
        
        

        fetch('src/4D_repos_metadata.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('not ok')
                }
                return response.json();
            })
            .then(data => {
                la.$('#a').style('label',data[0]['name']);
                updateRepo(data);
            })
            .catch(error => {
                console.error(error)
            });
        
    </script>
</body>
</html>